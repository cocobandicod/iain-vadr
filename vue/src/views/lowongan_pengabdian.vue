<script setup>
import { ref, onMounted } from 'vue';
import api from '../api';
import 'datatables.net-bs5';
import $ from 'jquery';
import {
  formatTanggal,
  formatRupiah,
  thnsekarang,
} from '../utils/globalFunctions';
import GlobalFooter from '../components/footer.vue';

const lowongan = ref([]);
const isLoading = ref(true);

const fetchDataLowongan = async () => {
  try {
    const response = await api.get('/api/lowonganpenelitian');
    lowongan.value = response.data.data.data;
  } catch (error) {
    console.error('Error fetching lowongan data:', error);
  } finally {
    isLoading.value = false;
  }
};

onMounted(async () => {
  await fetchDataLowongan();
  initializeDataTable();
});

const initializeDataTable = () => {
  $(document).ready(function () {
    $('#DTable1').DataTable({
      stateSave: false,
      autoWidth: true,
      processing: true,
      ordering: false,
      responsive: true,
      columnDefs: [
        {
          className: 'text-center p-2',
          width: '3%',
          targets: [0, 1, 3, 4, 5],
        },
        {
          className: 'text-end p-2',
          targets: [6],
        },
        {
          className: 'p-2',
          targets: [0, 1, 2, 3, 4, 5, 6, 7],
        },
      ],
      language: {
        processing:
          '<span><i class="mdi mdi-spin mdi-loading me-1"></i> Memuat Data..</span>',
        search: "<div class='fs-13'>Pencarian</div> _INPUT_",
        searchPlaceholder: 'Masukan Kata Kunci',
        lengthMenu: "<div class='fs-13'>Tampilkan</div> _MENU_",
        info: "<div class='fs-13'>Menampilkan _START_ sampai _END_ dari _TOTAL_ entri</div>",
        zeroRecords: 'Tidak ada data yang ditemukan',
        infoEmpty:
          "<div class='fs-13'>Menampilkan 0 sampai 0 dari 0 entri</div>",
        infoFiltered:
          "<div class='fs-13'>(disaring dari total _MAX_ entri)</div>",
      },
    });
  });
};
</script>

<template>
  <section class="section bg-light">
    <div class="bg-overlay bg-overlay-pattern"></div>
    <div class="container pt-5">
      <div class="row justify-content-center">
        <div class="col-lg-8">
          <div class="text-center mb-5">
            <h3 class="mb-3 fw-semibold">
              Lowongan Pengabdian Tahun {{ thnsekarang() }}
            </h3>
            <p class="text-muted mb-4">
              Lowongan Pengabdian Universitas Negeri Gorontalo
            </p>
          </div>
        </div>
        <!-- end col -->
      </div>
      <!-- end row -->
      <div class="row justify-content-center">
        <div v-if="isLoading" class="d-flex justify-content-center">
          <div class="spinner-border" role="status">
            <span class="visually-hidden">Loading...</span>
          </div>
        </div>
        <div v-else class="col-lg-10 gy-8 card">
          <table
            id="DTable1"
            class="table table-bordered dt-responsive table-striped align-middle fs-12 mb-0"
            style="width: 100%">
            <thead class="table-light">
              <tr>
                <th>No</th>
                <th>TA</th>
                <th>Jenis</th>
                <th>Quota</th>
                <th>Pengusul</th>
                <th>Setuju</th>
                <th>Total Dana (Rp.)</th>
                <th>Tanggal Berakhir</th>
              </tr>
            </thead>
            <tbody>
              <tr v-for="(item, index) in lowongan" :key="index">
                <td>{{ index + 1 }}</td>
                <td>{{ item.tahun_anggaran }}</td>
                <td>{{ item.jenis }}</td>
                <td>{{ item.quota }}</td>
                <td>{{ item.pengusul }}</td>
                <td>{{ item.diterima }}</td>
                <td>{{ formatRupiah(item.total_dana) }}</td>
                <td>
                  {{ formatTanggal(item.tgl_berakhir) }}
                </td>
              </tr>
            </tbody>
          </table>
          <!--end col-->
        </div>
      </div>
      <!--end row-->
    </div>
    <!-- end container -->
  </section>
  <!-- Start footer -->
  <GlobalFooter />
  <!-- end footer -->
</template>

<script>
export default {
  name: 'panduan',
};
</script>
